<div class="card">
    <!-- <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script> -->
    <script
        src="https://code.jquery.com/jquery-3.6.0.min.js"

        ></script>
    <!-- <script type="text/javascript"> </script> -->
    <script type="text/javascript">
    // const { JSDOM } = require( "jsdom" );
    // const { window } = new JSDOM( "" );
    // const $ = require( "jquery" )( window );
    // const Binance = require('node-binance-api');
        $(document).ready(function()
            {
            $("select").change(async function(event){
                // alert("Hello World");
                var data = $("data").val();
                var conf;
                var id = $(this).val();
                data = JSON.parse(data);
                for(var i=0;i<data.length;i++){
                    if(id == data[i]._id){
                        console.log('we found it', data[i]);
                        conf = data[i];
                    }
                }
                const balanceBuffer = conf.balanceBuffer;
                console.log('balanceBuffer',balanceBuffer);
                
                const d = {apiKey: conf.apiKey, secretKey: conf.secretKey};
                const con = await fetch('/getAvailableBalance', {
                    method: 'PUT', 
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(d),
                })
                .then(res => res.json())
                .then((response) => {
                    console.log('response data',response)
                    const maxAmount = (balanceBuffer/100)*(+response['result'])
                    console.log('maxAmount',maxAmount)
                    if(maxAmount >=10){
                        $("#amount").val(maxAmount);
                    }else{
                        alert('You have not enough balance for this trade');
                    }
                }).catch((err) => {
                    console.log('error occurred');
                    throw err;
                })
                // console.log('confs', con);
                // $.get( "/allConfs", function( data ) {
                //     $( ".result" ).html( data );
                // });
                // jQuery.post( url,  data , success , dataType  )
                // $.ajax({
                //     type: "GET",
                //     url: "/allConfs",
                //     dataType: "json",
                //     success: function (result, status, xhr) {
                //         console.log('result', result);
                //     },
                //     error: function (xhr, status, error) {
                //         alert("Result: " + status + " " + error + " " + xhr.status + " " + xhr.statusText)
                //     }
                // });
                // console.log($(confs));
                
            });
        });
    </script>
    <div class="card-header">
        <h4 class="font-weight-bold">Add New Order</h4>
    </div>
    
    <div class="card-body">
        <form action="/addOrder" method="post">
            <div class="row">
                <div style="display: none;">
                    <data value="<%= JSON.stringify(confs) %>"></data>
                </div>
                <div class="col-6">
                    <label class="col-form-label" for="tokenname">Token Name</label>
                    <input list="browsers" name="tokenname" id="tokenname" class="form-control"
                    placeholder="Token Name">
                    <datalist id="browsers">
                        <% for(let tick of tickArr) { %>
                            <option value="<%= tick %>"><%= tick %></option>
                        <% } %>
                    </datalist>
                    <!-- <div class="form-group">
                        <label class="col-form-label" for="tokenname">Token Name</label>
                        <input type="text" class="form-control" name="tokenname" placeholder="Enter Token name" id="tokenname">
                    </div> -->
                </div>
                <div class="col-6">
                    <div class="form-group">
                        <label class="col-form-label" for="buyprice">Buy Price</label>
                        <input type="number" class="form-control" name="buyprice" placeholder="Enter Buy Price" id="buyprice">
                    </div>
                </div>
                <!-- <button onclick=""></button> -->
                <div class="col-6">
                    <div class="form-group">
                        <label class="col-form-label" for="stoploss">Stop Loss</label>
                        <input type="number" class="form-control" name="stoploss" placeholder="Enter your Stop Loss" id="stoploss">
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-group">
                        <label class="col-form-label" for="amount">Amount</label>
                        <input type="text" class="form-control" name="amount" placeholder="Enter your Amount" id="amount">
                    </div>
                </div>
                <div class="col-6 form-group">
                    <label class="col-form-label" for="confId">Configuration</label>
                    <select name="confId" id="confId" class="form-control" change="onChange($event)">
                        <% if(confs.length > 0) { %>
                            <option value="">Select Configuration</option>
                        <% } else { %>
                            <option value="">No Configuration Available</option>
                        <% } %>

                        <% for(let conf of confs) { %>
                            <option value="<%= conf.id %>"><%= conf.name %></option>
                        <% } %>
                    </select>
                  <!-- <div *ngIf="titleSelect.controls['title'].errors?.required &&
                  titleSelect.controls['title'].touched" class="required">Option Required</div> -->
                </div>
                <!-- <div class="col-6">
                    <div class="form-group">
                        <label class="col-form-label" for="cnic">CNIC</label>
                        <input type="text" class="form-control" name="cnic" placeholder="22222-2222222-2" id="cnic">
                    </div>
                </div>
                <div class="col-12">
                    <div class="form-group">
                        <label for="addres">Address</label>
                        <textarea class="form-control" name="address" id="address" rows="3"></textarea>
                    </div>
                </div> -->
            </div>
            <div class="" style="margin-top: 15px;">
                <button itype="submt" class="btn btn-success">Submit</button>
                <a href="/allOrders" class="btn btn-light">Cancel</a>
            </div>
        </form>
    </div>
</div>




<!-- <script>
    
// function onChange(e){
//     var sel = document.getElementById('confId');
//     console.log('hello', sel.value );
// }
$(document).ready(function() {

// var roomID = "0"
// $('.dropone').load('ajaxdropdown.aspx');
// $('.droptwo').load('ajaxdropdown.aspx?drpType=room&roomid=' + roomID);

$('#confId').change(function() {
    console.log('conf id called');
var ts = new Date().getTime();
alert($(this).val)

    $(".droptwo").empty();
    $(".droptwo").load("ajaxdropdown.aspx?drpType=room&roomid=" + $(this).attr("value") + "&ts=" + ts);
});

}); 

</script> -->